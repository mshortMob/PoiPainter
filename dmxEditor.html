<html>
	<head>
		<title>FlowMapper</title>
		<style>
			body{
			    margin:0px;
				background-color:black;
			}	
			#guiContainer{
				position:absolute;
				width:50%;
				right:0%;
			}
		</style>
	</head>
	<body>
		<script src="dependancies/dat.gui.min.js"></script>
		
		<script>
				
			initGlobalVars();

			function initGlobalVars(){
				addControls();
				statesArray=[];
				for(var x=0;x<4;x++){
					var objectJSON ={}
					for (var key in channelsController) {
						objectJSON[key]=channelsController[key]
					}
					statesArray.push(objectJSON)
				}
				updateControlsView();
				;
			}
							
			function addControls(){
				globalController  = {
					selectedFixture:0
				};
				channelsController = {
					R:0,
					G:0,
					B:0,
				};
				//--------	
				gui = new dat.GUI({ autoPlace: false });
				guiContainer=document.createElement('div');
				guiContainer.id="guiContainer";
				document.body.appendChild(guiContainer);
				guiContainer.appendChild(gui.domElement);
				gui.width=guiContainer.offsetWidth;
				//--------		
				globalFolder=gui.addFolder( "Global" )
				globalFolder.open();
				globalFolder.add(globalController, "selectedFixture", 0, 3, 1 ).onChange(function(){globalController.selectedFixture=parseInt(globalController.selectedFixture);updateControlsView();;});						
				channelsFolder=gui.addFolder( "Channels" )
				channelsFolder.open();
				channelsFolder.add( channelsController, "R", 0, 255, 1).onChange(function(){updateControlsValues();});
				channelsFolder.add( channelsController, "G",  0, 255, 1).onChange(function(){updateControlsValues();});
				channelsFolder.add( channelsController, "B",  0, 255, 1).onChange(function(){updateControlsValues();});	
				utilsFolder=gui.addFolder( "Utils" )
				utilsFolder.open();
				utilsFolder.add({ 'Full Screen':function(){ requestFullScreen() }},'Full Screen');
				utilsFolder.add({ 'Save Preset':function(){ saveState() }},'Save Preset');
				utilsFolder.add({ 'Recall Preset':function(){ recallState() }},'Recall Preset');
				// dmxFolder.add(globalController, "DMX_Preset", 1,6,1 ).onChange(function(){globalController.DMX_Preset=parseInt(globalController.DMX_Preset);  updateControlsValues(); retrievePixelPattern();});
			}
									
			function updateControlsView(){
				for (var i in gui.__folders.Channels.__controllers) {
					channelsController[gui.__folders.Channels.__controllers[i].property]=statesArray[parseInt(globalController.selectedFixture)][gui.__folders.Channels.__controllers[i].property];
					gui.__folders.Channels.__controllers[i].updateDisplay();
				}
			}
			
			function updateControlsValues(){  
				for (var i in gui.__folders.Channels.__controllers) {
				  statesArray[parseInt(globalController.selectedFixture)][gui.__folders.Channels.__controllers[i].property]=channelsController[gui.__folders.Channels.__controllers[i].property];
				}
			}
																			
			function saveState(){
				var requestBody=JSON.stringify({"storage" : statesArray})
				var xmlhttp=new XMLHttpRequest();
				xmlhttp.open("POST", "php/write.php?fn=dmxTests/test.txt", true);
				xmlhttp.send(requestBody);
				xmlhttp.onload = function(e){console.log(xmlhttp.response.status)}
			}
			
			function recallState(){
				var xmlhttp=new XMLHttpRequest();
				xmlhttp.open("GET", "php/read.php?fn=dmxTests/test.txt", true);
				xmlhttp.send();
				xmlhttp.onload = function(e){
					statesArray=JSON.parse(xmlhttp.response).storage
					globalState=JSON.parse(xmlhttp.response).global
					// presetsArray=JSON.parse(xmlhttp.response).storage2
					updateControlsView();
				}
			}					
		
			function requestFullScreen() {
				// Supports most browsers and their versions.
				var element = document.body; // Make the body go full screen.
				var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;
			
				if (requestMethod) { // Native full screen.
					requestMethod.call(element);
				} else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
					var wscript = new ActiveXObject("WScript.Shell");
					if (wscript !== null) {
						wscript.SendKeys("{F11}");
					}
				}
			}	
		</script>
	</body>
</html>

