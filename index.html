<html>
	<head>
		<title>FlowMapper</title>
		<style>
			body{
			    margin:0px;
				background-color:black;
			}	
			canvas{
				opacity: 1;
				width:100%;
				height:100%;
				top:0px;
				left:0px;
				z-index:10;
				transform:scale(1,1);
				position:fixed;
				float:left;
				object-fit:fill;
				/* cursor: none; */
			}
			textarea{
				z-index:100;
				position:fixed;
				height:42.5%;
				width:35%;
				background-color: grey;
				border-color: #515151;
				border-width:4;
				border-top-width:8;
				border-left-width:8;
				border-right-width:8;
				font-size: 14px;
				wrap: off;
				white-space: nowrap;
			}
			#show_shader_editor{
				z-index:100;
				position:fixed;
				left:0px;
				top:0px;
				height:6%;
				width:100px;
				background-color: darkgrey;
				border-color: #515151;
				border-width:4;
				border-top-width:0;
				border-left-width:0;
				font-size: 14px;
			}
			#hide_shader_editor{
				z-index:100;
				position:fixed;
				left:0px;
				bottom:0px;
				height:15%;
				width:10%;
				background-color: darkgrey;
				border-color: #515151;
				border-width:4;
				border-left-width:8;
				border-bottom-width:8;
				font-size: 18px;
			}
			#update_shader_button{
				z-index:100;
				position:fixed;
				left:10%;
				bottom:0px;
				height:15%;
				width:25%;
				background-color: darkgrey;
				border-color: #515151;
				border-width:4;
				border-right-width:8;
				border-bottom-width:8;
				font-size: 24px;
			}
			#update_shader_button:active{
				background-color: grey;			
			}
			video{
				opacity: 1;
				width:100%;
				height:100%;
				top:0px;
				left:0px;
				z-index:-1;
				transform:scale(-1,1);
				position:fixed;
				float:left;
				object-fit:fill;
			}
		</style>
	</head>
	<body>
		<script src="dependancies/dat.gui.min.js"></script>
		<script>
		
			// dmxInterval=setInterval(writeDMX,100);

			getPatternData();
			function getPatternData(){
				patternData=[];
				var xmlhttp=new XMLHttpRequest();
				xmlhttp.open("GET", "../php/read.php?fn=datout.txt", true);
				xmlhttp.send();
				xmlhttp.onload = function(e){
                    patternDataString=xmlhttp.response;
					patternDataStringArray=patternDataString.split('\n');
					for(var x=0; x<patternDataStringArray.length; x++){
						var temp=patternDataStringArray[x].split(',');
						for(var y=0; y<temp.length; y++){
							temp[y]=parseInt(temp[y]);
						}
						patternData.push(temp);
					}
					masterIndex=0;
					setInterval(function(){
						masterIndex=(masterIndex+1)%patternData.length;
						writeDMX();
					},100)
				}
			}
			
			function writeDMX() {
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						console.log("Send DMX: "+this.responseText);
					}
				};
				xhttp.open("POST","proxy/set_dmx", true);
				xhttp.setRequestHeader("accept", "*/*");
				xhttp.setRequestHeader("accept-language", "en-US,en;q=0.9,und;q=0.8");
				xhttp.setRequestHeader("cache-control", "no-cache");
				xhttp.setRequestHeader("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
				xhttp.setRequestHeader("pragma", "no-cache" );

				dmxPayloadString="u=0&d="+patternData[masterIndex].toString()+"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0";
				console.log(dmxPayloadString);
				xhttp.send(dmxPayloadString);
			}	
		</script>
	</body>
</html>

