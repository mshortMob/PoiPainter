<html>
	<head>
		<title>FlowMapper</title>
		<style>
			body{
			    margin:0px;
				background-color:black;
			}	
			canvas{
				width:22%;
				height:100%;
				border-color:grey;
				border-width:thick;
				border-style: solid;
				margin-right:0px;
				margin-left:0px;
				position:relative;
			}
		</style>
	</head>
	<body>
		<canvas id="slider1" onmousedown="selectedSlider=this.id;drawSliderPosition(this.id, mouseheight);" onmouseup="selectedSlider='';" ></canvas>
		<canvas id="slider2" onmousedown="selectedSlider=this.id;drawSliderPosition(this.id, mouseheight);" onmouseup="selectedSlider='';" ></canvas>
		<canvas id="slider3" onmousedown="selectedSlider=this.id;drawSliderPosition(this.id, mouseheight);" onmouseup="selectedSlider='';" ></canvas>
		<canvas id="slider4" onmousedown="selectedSlider=this.id;drawSliderPosition(this.id, mouseheight);" onmouseup="selectedSlider='';" ></canvas>
	</body>
	<script>

featherwingPatterns=[[000,000,000,000,000,000,000,000,000,000,000,000],
                     [100,000,000,100,000,000,100,000,000,100,000,000],
                     [000,100,000,000,100,000,000,100,000,000,100,000],
                     [100,000,100,000,000,100,000,000,100,100,000,100],
                     [000,000,100,000,000,100,000,000,100,000,000,100],
                     [000,000,100,000,100,000,000,100,000,000,000,100],
                     [000,100,100,000,100,000,050,100,000,100,100,000],
                     [100,000,000,000,000,100,000,000,100,100,000,000],
                     [000,000,000,000,000,000,000,000,000,100,100,100],
                     [000,000,000,000,000,000,100,100,100,000,000,000],
                     [000,000,000,100,100,100,000,000,000,000,000,000],
                     [100,100,100,000,000,000,000,000,000,000,000,000]];

		var selectedSlider="";
		sliderValues={"slider1":0,"slider2":0,"slider3":0,"slider4":0}
		function drawSliderPosition(sliderId, percentToFill){
			var c = document.getElementById(sliderId);
			var ctx = c.getContext("2d");
			ctx.clearRect(0, 0, c.width, c.height);
			ctx.beginPath();
			ctx.fillStyle = "lightgrey";
			ctx.rect(0, c.height-c.height*percentToFill, c.width, c.height*percentToFill);
			ctx.fill();
			sliderValues[sliderId]=parseInt(255*percentToFill);
			if(sliderValues[sliderId]<30){
				sliderValues[sliderId]=0;
			}
			writeDMX();
		}

		var mouseheight=0;
		document.onmousemove=function(mouseevent){
			mouseheight=1-(mouseevent.clientY/window.innerHeight);
			if(selectedSlider!=""){
				drawSliderPosition(selectedSlider, mouseheight);
			}
		}

		function writeDMX() {
			writeDMXBox();
			writeFeatherwings();
		}

		function writeDMXBox() {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					console.log("Send DMX: "+this.responseText);
				}
			};
			xhttp.open("POST","proxy/set_dmx", true);
            xhttp.setRequestHeader("accept", "*/*");
            xhttp.setRequestHeader("accept-language", "en-US,en;q=0.9,und;q=0.8");
            xhttp.setRequestHeader("cache-control", "no-cache");
            xhttp.setRequestHeader("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
            xhttp.setRequestHeader("pragma", "no-cache" );
			xhttp.send("u=3&d="+sliderValues["slider1"]+","+sliderValues["slider2"]+","+sliderValues["slider3"]+","+sliderValues["slider4"]+"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0");
		}

		function writeFeatherwings() {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					console.log("Send DMX: "+this.responseText);
				}
			};
			xhttp.open("POST","proxy/set_dmx", true);
            xhttp.setRequestHeader("accept", "*/*");
            xhttp.setRequestHeader("accept-language", "en-US,en;q=0.9,und;q=0.8");
            xhttp.setRequestHeader("cache-control", "no-cache");
            xhttp.setRequestHeader("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
            xhttp.setRequestHeader("pragma", "no-cache" );
			xhttp.send("u=2&d="+featherwingPatterns[parseInt((sliderValues["slider1"]/255)*12)].toString()+",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0");
		}		

		function initializeDMX() {
			xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					console.log("Initialize DMX: "+this.responseText);
				}
			};
			xhttp.open("GET","proxy/reload", true);
			xhttp.send();
		}
		// setTimeout(function(){initializeDMX();setInterval(writeDMX,1000);},10000);

	</script>
</html>
