<html>
	<head>
		<title>FlowMapper</title>
		<style>
			body{
			    margin:0px;
				background-color:black;
			}	
			canvas{
				opacity: 1;
				width:100%;
				height:100%;
				top:0px;
				left:0px;
				z-index:10;
				transform:scale(1,1);
				position:fixed;
				float:left;
				object-fit:fill;
			}
		</style>
	</head>
	<body>
		<canvas id="canvasp8" style="display: none;"></canvas>
		<script type="text/javascript" src="jsmpeg.min.js"></script>
		<script src="pixel8.js"></script>
		<script type="text/javascript">

			var canvas = document.createElement('canvas');
			canvas.id='vcanvas'
			document.body.appendChild(canvas);
			var url = 'ws://'+document.location.hostname+':9999/';
			var player = new JSMpeg.Player(url, {canvas: canvas, disableGl:true, preserveDrawingBuffer:false});

			function getPixelData(){
				dada=pixel8(canvas);
				var pixelDataString="";
				for(i=1;i<9;i++){
					pixelDataString=pixelDataString+dada.pixelAt(parseInt(canvas.width/10*i),canvas.height/2)["red"]*0+","+dada.pixelAt(parseInt(canvas.width/10*i),canvas.height/2)["green"]*0+","+dada.pixelAt(parseInt(canvas.width/10*i),canvas.height/2)["blue"]+",";
				}
				return pixelDataString;
			}

			function writeDMX() {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					console.log("Send DMX: "+this.responseText);
				}
			};
			xhttp.open("POST","proxy/set_dmx", true);
            xhttp.setRequestHeader("accept", "*/*");
            xhttp.setRequestHeader("accept-language", "en-US,en;q=0.9,und;q=0.8");
            xhttp.setRequestHeader("cache-control", "no-cache");
            xhttp.setRequestHeader("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
            xhttp.setRequestHeader("pragma", "no-cache" );
			xhttp.send("u=0&d="+getPixelData()+"0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0");
		}	

		function initializeDMX() {
			xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					console.log("Initialize DMX: "+this.responseText);
				}
			};
			xhttp.open("GET","proxy/reload", true);
			xhttp.send();
		}
		setTimeout(function(){initializeDMX();setInterval(writeDMX,150);},3000);

		</script>
	</body>
</html>

